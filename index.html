<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Catálogo de Productos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    transition: background 0.3s;
}

/* Pestañas laterales */
#tabs {
    position: fixed;
    right: 0;
    top: 0;
    width: 180px;
    height: 100%;
    background: #222;
    overflow-y: auto;
    padding-top: 10px;
}

.tab {
    padding: 12px;
    cursor: pointer;
    color: white;
    border-bottom: 1px solid #444;
}

.tab:hover {
    background: #444;
}

/* Área productos */
#content {
    margin-right: 190px;
    padding: 15px;
}

.grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
}

/* Tarjetas */
.card {
    background: white;
    border-radius: 10px;
    padding: 10px;
    box-shadow: 0 0 8px rgba(0,0,0,0.15);
    text-align: center;
}

.card img {
    width: 100%;
    height: 160px;
    object-fit: contain;
    border: 1px solid #ddd;
    background: #f9f9f9;
}

.codigo {
    font-weight: bold;
    font-size: 18px;
    margin-bottom: 5px;
}

.precio {
    font-size: 20px;
    color: green;
    font-weight: bold;
    margin: 5px 0;
}

.linea {
    font-size: 14px;
}
</style>
</head>

<body>

<div id="tabs"></div>
<div id="content">
    <div id="productos" class="grid"></div>
</div>

<script>
const archivoCSV = "stock.csv"; // mismo directorio

let productos = [];
let rubros = [];

/* FORMATO PRECIO */
function formatPrecio(num) {
    return "$ " + Number(num).toLocaleString("es-AR");
}

/* CARGAR CSV */
fetch(archivoCSV)
.then(r => {
    if (!r.ok) throw new Error("No se pudo cargar stock.csv");
    return r.text();
})
.then(data => {
    parseCSV(data);
    crearTabs();
    if (rubros.length > 0) mostrarRubro(rubros[0]);
})
.catch(err => {
    alert("ERROR LEYENDO STOCK.CSV\n" + err);
});

/* PARSE CSV CON ; */
function parseCSV(texto) {
    let lineas = texto.split(/\r?\n/).filter(l => l.trim() !== "");
    let headers = lineas[0].split(";");

    for (let i = 1; i < lineas.length; i++) {
        let c = lineas[i].split(";");

        let obj = {};
        headers.forEach((h, j) => obj[h.trim()] = (c[j] || "").trim());

        productos.push(obj);
        if (!rubros.includes(obj.Rubro)) rubros.push(obj.Rubro);
    }
}

/* CREAR PESTAÑAS */
function crearTabs() {
    let tabs = document.getElementById("tabs");
    tabs.innerHTML = "";

    rubros.forEach((r, i) => {
        let div = document.createElement("div");
        div.className = "tab";
        div.textContent = r;
        div.onclick = () => mostrarRubro(r);
        tabs.appendChild(div);
    });
}

/* MOSTRAR RUBRO */
function mostrarRubro(rubro) {
    let color = generarColor(rubro);
    document.body.style.background = color;

    let cont = document.getElementById("productos");
    cont.innerHTML = "";

    productos.filter(p => p.Rubro === rubro).forEach(p => {
        let card = document.createElement("div");
        card.className = "card";

        let codigo = p.Codigo;
        let foto = buscarFoto(codigo);

        card.innerHTML = `
            <div class="codigo">${codigo}</div>
            <img src="${foto}" onerror="this.src='nofoto.png'">
            <div class="precio">${formatPrecio(p.Precio)}</div>
            <div class="linea">${p.Linea1 || ""}</div>
            <div class="linea">${p.Linea2 || ""}</div>
            <div class="linea">${p.Linea3 || ""}</div>
            <div class="linea">${p.Linea4 || ""}</div>
        `;
        cont.appendChild(card);
    });
}

/* COLOR POR RUBRO */
function generarColor(txt) {
    let hash = 0;
    for (let i = 0; i < txt.length; i++) hash = txt.charCodeAt(i) + ((hash << 5) - hash);
    let color = "#";
    for (let i = 0; i < 3; i++) {
        let v = (hash >> (i * 8)) & 255;
        color += ("00" + v.toString(16)).slice(-2);
    }
    return color;
}

/* BUSCAR FOTO */
function buscarFoto(codigo) {
    return "FOTO/" + codigo + ".jpg";
}
</script>

</body>
</html>
