<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>CATÁLOGO GENERAL</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    transition: background 0.4s;
}

/* Rubros lateral */
#rubros {
    width: 200px;
    height: 100vh;
    overflow-y: auto;
    background: #111;
    color: white;
    padding: 10px;
    position: fixed;
}

#rubros button {
    width: 100%;
    margin: 3px 0;
    padding: 8px;
    background: #222;
    border: none;
    color: white;
    cursor: pointer;
    text-align: left;
}

#rubros button:hover {
    background: #555;
}

/* Contenido */
#contenido {
    margin-left: 220px;
    padding: 10px;
}

/* Buscador */
#buscador {
    padding: 10px;
    width: 300px;
    font-size: 16px;
    margin-bottom: 10px;
}

/* Grilla productos */
.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 10px;
}

.producto {
    background: rgba(255,255,255,0.9);
    border: 2px solid black;
    padding: 8px;
    border-radius: 6px;
    text-align: center;
}

.producto img {
    max-width: 100%;
    height: 180px;
    object-fit: contain;
    border-bottom: 1px solid #ccc;
}

/* Rubros colores fondo */
.bg-Air-Fryer { background: #ffe6cc; }
.bg-Aspiradoras { background: #e6f2ff; }
.bg-Heladeras { background: #e6ffe6; }
.bg-Televisores { background: #f2e6ff; }
</style>
</head>

<body>

<div id="rubros"></div>

<div id="contenido">
<input id="buscador" placeholder="Buscar código o descripción...">
<div id="productos" class="grid"></div>
</div>

<script>
const CSV_FILE = "PRODUCTOS.csv";
const FOTO_FOLDERS = ["FOTOS1","FOTOS2","FOTOS3","FOTOS4","FOTOS5","FOTOS6"];

let productos = [];
let rubros = new Set();
let rubroActual = "";

// FORMATEAR PRECIO
function formatPrecio(p) {
    return "$ " + Number(p).toLocaleString("es-AR");
}

// BUSCAR IMAGEN EN TODAS LAS CARPETAS
function buscarImagen(codigo) {
    return new Promise(resolve => {
        let i = 0;
        function probar() {
            if (i >= FOTO_FOLDERS.length) {
                resolve("noimg.jpg"); // imagen fallback
                return;
            }
            let url = FOTO_FOLDERS[i] + "/" + codigo + ".JPG";
            let img = new Image();
            img.onload = () => resolve(url);
            img.onerror = () => { i++; probar(); };
            img.src = url;
        }
        probar();
    });
}

// LEER CSV
fetch(CSV_FILE)
.then(r => r.text())
.then(text => {
    let lines = text.trim().split("\n");
    let headers = lines[0].split(";");

    for (let i = 1; i < lines.length; i++) {
        let cols = lines[i].split(";");
        if (cols.length < 3) continue;

        let obj = {};
        headers.forEach((h, j) => obj[h] = cols[j] || "");
        productos.push(obj);
        rubros.add(obj.RUBRO);
    }

    productos.sort((a,b)=> a.CODIGO.localeCompare(b.CODIGO));

    crearRubros();
    mostrarRubro([...rubros][0]);
});

// CREAR BOTONES RUBROS
function crearRubros() {
    let div = document.getElementById("rubros");
    rubros.forEach(r => {
        let b = document.createElement("button");
        b.textContent = r;
        b.onclick = () => mostrarRubro(r);
        div.appendChild(b);
    });
}

// MOSTRAR RUBRO
async function mostrarRubro(r) {
    rubroActual = r;
    document.body.className = "bg-" + r.replace(/ /g,"-");

    let cont = document.getElementById("productos");
    cont.innerHTML = "";

    let lista = productos.filter(p => p.RUBRO == r);

    for (let p of lista) {
        let img = await buscarImagen(p.CODIGO);

        let d = document.createElement("div");
        d.className = "producto";
        d.innerHTML = `
            <img src="${img}">
            <h3>${p.CODIGO}</h3>
            <b>${p.LINEA1 || ""}</b><br>
            ${p.LINEA2 || ""}<br>
            ${p.LINEA3 || ""}<br>
            ${p.LINEA4 || ""}<br>
            <h2>${formatPrecio(p.PRECIO)}</h2>
        `;
        cont.appendChild(d);
    }
}

// BUSCADOR
document.getElementById("buscador").addEventListener("input", e => {
    let t = e.target.value.toLowerCase();
    let cont = document.getElementById("productos");
    cont.innerHTML = "";

    productos.filter(p =>
        p.CODIGO.toLowerCase().includes(t) ||
        (p.LINEA1 || "").toLowerCase().includes(t)
    ).forEach(async p => {
        let img = await buscarImagen(p.CODIGO);
        let d = document.createElement("div");
        d.className = "producto";
        d.innerHTML = `
            <img src="${img}">
            <h3>${p.CODIGO}</h3>
            <b>${p.LINEA1 || ""}</b><br>
            ${p.LINEA2 || ""}<br>
            <h2>${formatPrecio(p.PRECIO)}</h2>
        `;
        cont.appendChild(d);
    });
});
</script>

</body>
</html>
