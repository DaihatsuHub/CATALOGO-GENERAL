<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CAT√ÅLOGO GENERAL</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f0f0f0;
}

/* ===== TOP BAR ===== */
.top-bar {
    background: #2c2c2c;
    padding: 8px 0;
}

.top-bar-inner {
    max-width: 1200px;
    margin: auto;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    padding: 0 15px;
}

.logo {
    height: 36px;
    width: auto;
}

/* BUSCADOR */
.search-bar {
    position: relative;
    flex: 1;
    max-width: 600px;
}

.search-bar input {
    width: 100%;
    padding: 10px 40px 10px 15px;
    border-radius: 8px;
    border: none;
    background: #d9d9d9;
    font-size: 14px;
    outline: none;
}

.search-icon {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 16px;
    color: #333;
}

/* ===== PANEL RUBROS ===== */
#rubros {
    width: 220px;
    height: 100vh;
    background: #111;
    color: white;
    position: fixed;
    padding: 10px;
    overflow-y: auto;
}

#rubros button {
    width: 100%;
    margin: 4px 0;
    padding: 8px;
    background: #222;
    border: none;
    color: white;
    cursor: pointer;
    text-align: left;
    font-size: 14px;
}

#rubros button:hover {
    background: #555;
}

/* ===== CONTENIDO ===== */
#contenido {
    margin-left: 230px;
    padding: 10px;
}

/* SELECTOR MOBILE */
#selectorRubro {
    background: orange;
    padding: 8px;
    margin-bottom: 6px;
    border-radius: 6px;
    display: none;
}

#rubroSelect {
    width: 100%;
    font-size: 16px;
    padding: 8px;
    border: none;
    border-radius: 4px;
}

/* ===== GRID ===== */
.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 14px;
}

/* ===== PRODUCTO CARD ===== */
.producto {
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 18px rgba(0,0,0,0.20);
    overflow: hidden;
    transition: transform 0.2s;
    min-height: 560px; /* M√ÅS RECTANGULAR */
}

.producto:hover {
    transform: translateY(-3px);
}

/* FOTO GRANDE REAL */
.producto img {
    width: 100%;
    height: 360px; /* 30% m√°s grande REAL */
    object-fit: contain;
    background: #fff;
}

/* BLOQUE INFO GRIS */
.info {
    background: #e9e9e9;
    padding: 12px;
}

/* TEXTO */
.info h3 {
    margin: 4px 0;
    font-size: 16px;
    text-align: center;
}

.desc {
    font-size: 13px;
    line-height: 1.25;
    color: #333;
    text-align: center;
}

.precio {
    font-size: 20px;
    font-weight: bold;
    color: darkred;
    margin-top: 12px;
    text-align: center;
}

/* ===== MODAL ===== */
#modal {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

#modal img {
    max-width: 95%;
    max-height: 95%;
}

#modal span {
    position: absolute;
    top: 20px;
    right: 30px;
    color: white;
    font-size: 30px;
    cursor: pointer;
}

/* ===== MOBILE ===== */
@media (max-width: 600px) {

    .top-bar-inner {
        flex-direction: column;
        align-items: center;
    }

    .logo {
        height: 32px;
        width: auto; /* NO ESTIRAR */
    }

    #rubros {
        display: none;
    }

    #selectorRubro {
        display: block;
    }

    #contenido {
        margin-left: 0;
        padding: 6px;
    }

    .grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
    }

    .producto {
        min-height: 420px;
    }

    .producto img {
        height: 220px;
    }

    .desc {
        font-size: 12px;
    }

    .precio {
        font-size: 16px;
    }
}
</style>
</head>

<body>

<!-- TOP BAR -->
<div class="top-bar">
  <div class="top-bar-inner">
    <img src="LOGO.jpg" class="logo">

    <div class="search-bar">
        <input id="buscador" placeholder="¬øQu√© est√°s buscando?">
        <span class="search-icon">üîç</span>
    </div>
  </div>
</div>

<div id="rubros"></div>

<div id="contenido">

<div id="selectorRubro">
    <select id="rubroSelect"></select>
</div>

<div id="productos" class="grid"></div>

</div>

<!-- MODAL -->
<div id="modal">
<span onclick="cerrarModal()">‚úñ</span>
<img id="modalImg">
</div>

<script>
const CSV_FILE = "PRODUCTOS.csv";
const FOTO_FOLDERS = ["FOTOS1","FOTOS2","FOTOS3","FOTOS4","FOTOS5","FOTOS6"];

let productos = [];
let rubros = new Set();

/* FORMATO PRECIO */
function formatPrecio(p) {
    return "$ " + Number(p).toLocaleString("es-AR");
}

/* BUSCAR FOTO */
function buscarImagen(codigo) {
    return new Promise(resolve => {
        let i = 0;
        function probar() {
            if (i >= FOTO_FOLDERS.length) {
                resolve("noimg.jpg");
                return;
            }
            let url = FOTO_FOLDERS[i] + "/" + codigo + ".jpg";
            let img = new Image();
            img.onload = () => resolve(url);
            img.onerror = () => { i++; probar(); };
            img.src = url;
        }
        probar();
    });
}

/* LEER CSV */
fetch(CSV_FILE)
.then(r => r.text())
.then(text => {
    let lines = text.trim().split("\n");
    let headers = lines[0].split(";").map(h=>h.trim().toUpperCase());

    for (let i=1; i<lines.length; i++) {
        let cols = lines[i].split(";");
        if (cols.length < 3) continue;
        let obj = {};
        headers.forEach((h,j)=> obj[h] = cols[j] ? cols[j].trim() : "");
        productos.push(obj);
        rubros.add(obj.RUBRO);
    }

    productos.sort((a,b)=> a.CODIGO.localeCompare(b.CODIGO));
    crearRubros();
    crearSelectorRubros();
    mostrarRubro([...rubros][0]);
});

/* PANEL RUBROS */
function crearRubros() {
    let div = document.getElementById("rubros");
    rubros.forEach(r => {
        let b = document.createElement("button");
        b.textContent = r;
        b.onclick = () => mostrarRubro(r);
        div.appendChild(b);
    });
}

/* SELECTOR MOBILE */
function crearSelectorRubros() {
    let sel = document.getElementById("rubroSelect");
    rubros.forEach(r => {
        let opt = document.createElement("option");
        opt.value = r;
        opt.textContent = r;
        sel.appendChild(opt);
    });
    sel.onchange = () => mostrarRubro(sel.value);
}

/* TEMPLATE CARD */
function cardHTML(p, img){
    return `
    <div class="producto">
        <img src="${img}" onclick="verGrande('${img}')">
        <div class="info">
            <h3>${p.CODIGO}</h3>
            <div class="desc">
                <b>${p.LINEA1||""}</b><br>
                ${p.LINEA2||""}<br>
                ${p.LINEA3||""}<br>
                ${p.LINEA4||""}
            </div>
            <div class="precio">${formatPrecio(p.PRECIO)}</div>
        </div>
    </div>`;
}

/* MOSTRAR RUBRO */
async function mostrarRubro(r) {
    let cont = document.getElementById("productos");
    cont.innerHTML = "";
    for (let p of productos.filter(p=>p.RUBRO==r)) {
        let img = await buscarImagen(p.CODIGO);
        cont.innerHTML += cardHTML(p, img);
    }
}

/* BUSCADOR GLOBAL */
document.getElementById("buscador").addEventListener("input", e=>{
    let t = e.target.value.toLowerCase().trim();
    let cont = document.getElementById("productos");
    cont.innerHTML = "";

    productos.filter(p=>{
        let texto = Object.values(p).join(" ").toLowerCase();
        return texto.includes(t);
    }).forEach(async p=>{
        let img = await buscarImagen(p.CODIGO);
        cont.innerHTML += cardHTML(p, img);
    });
});

/* MODAL */
function verGrande(src) {
    document.getElementById("modalImg").src = src;
    document.getElementById("modal").style.display = "flex";
}
function cerrarModal() {
    document.getElementById("modal").style.display = "none";
}
</script>

</body>
</html>
