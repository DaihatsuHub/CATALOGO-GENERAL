<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cat√°logo DAIHATSU</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f2f2f2;
}

/* HEADER */
header {
    background: #ff6a00;
    padding: 10px;
    display: flex;
    justify-content: center;
}
.header-box {
    max-width: 1200px;
    width: 100%;
    display: flex;
    align-items: center;
    gap: 15px;
}
header img {
    height: 60px;
    object-fit: contain;
}
header input {
    flex: 1;
    padding: 10px;
    border-radius: 6px;
    border: none;
    font-size: 16px;
}

/* RUBROS */
#rubros {
    background: #fff;
    padding: 10px;
    overflow-x: auto;
    white-space: nowrap;
}
.rubro-btn {
    padding: 8px 14px;
    border: none;
    background: #ddd;
    border-radius: 6px;
    margin-right: 6px;
    cursor: pointer;
}
.rubro-btn.activo {
    background: #ff6a00;
    color: white;
    font-weight: bold;
}
.rubro-btn:first-child {
    background: #c00;
    color: white;
    font-weight: bold;
}

/* GRID */
.grid {
    padding: 12px;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
}

/* PRODUCTO */
.producto {
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    overflow: hidden;
    min-height: 480px;
    position: relative;
}

/* ETIQUETA NUEVO */
.nuevo {
    position: absolute;
    top: 8px;
    left: 8px;
    background: red;
    color: white;
    font-size: 12px;
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: bold;
}

/* IMAGEN */
.producto img {
    width: 100%;
    height: 260px;
    object-fit: contain;
    background: white;
}

/* INFO */
.info {
    background: #eee;
    padding: 8px;
    text-align: center;
}
.codigo {
    font-weight: bold;
}
.linea {
    font-size: 14px;
}
.precio {
    margin-top: 6px;
    font-size: 16px;
    font-weight: bold;
    color: #c00;
}

/* MOBILE */
@media (max-width: 600px) {
    .grid {
        grid-template-columns: repeat(2, 1fr);
    }
    .producto img {
        height: 180px;
    }
    .producto {
        min-height: 380px;
    }
}
</style>
</head>

<body>

<header>
    <div class="header-box">
        <img src="LOGO.jpg" alt="DAIHATSU">
        <input type="text" id="buscador" placeholder="Buscar producto...">
    </div>
</header>

<div id="rubros"></div>
<div id="productos" class="grid"></div>

<script>
let productos = [];
let rubros = new Set();

/* CARGAR CSV */
fetch("PRODUCTOS.csv")
.then(r => r.text())
.then(data => {
    let filas = data.split("\n");
    let cab = filas[0].split(";");
    
    for (let i=1; i<filas.length; i++) {
        let v = filas[i].split(";");
        if (v.length < cab.length) continue;
        let obj = {};
        cab.forEach((c,j)=> obj[c.trim()] = v[j]?.trim());
        productos.push(obj);
    }

    // ordenar: novedades primero
    productos.sort((a,b)=>{
        if (a.NEW=="SI" && b.NEW!="SI") return -1;
        if (a.NEW!="SI" && b.NEW=="SI") return 1;
        return a.RUBRO.localeCompare(b.RUBRO);
    });

    rubros = new Set(productos.map(p => p.RUBRO));
    crearRubros();
    mostrarNovedades();
});

/* RUBROS */
function crearRubros() {
    let r = document.getElementById("rubros");
    r.innerHTML = `<button class="rubro-btn activo" onclick="mostrarNovedades()">NOVEDADES</button>`;
    rubros.forEach(x=>{
        r.innerHTML += `<button class="rubro-btn" onclick="mostrarRubro('${x}')">${x}</button>`;
    });
}

/* BUSCAR IMAGEN */
async function buscarImagen(cod) {
    let exts = ["jpg","png","webp"];
    for (let e of exts) {
        let url = "imagenes/" + cod + "." + e;
        let res = await fetch(url, {method:"HEAD"});
        if (res.ok) return url;
    }
    return "imagenes/no.jpg";
}

/* CARD */
function cardHTML(p, img) {
    return `
    <div class="producto">
        ${p.NEW=="SI" ? '<div class="nuevo">NUEVO</div>' : ''}
        <img src="${img}">
        <div class="info">
            <div class="codigo">${p.CODIGO}</div>
            <div class="linea">${p.LINEA1 || ""}</div>
            <div class="linea">${p.LINEA2 || ""}</div>
            <div class="precio">$ ${p.PRECIO || ""}</div>
        </div>
    </div>`;
}

/* MOSTRAR RUBRO */
async function mostrarRubro(r) {
    document.querySelectorAll(".rubro-btn").forEach(b=>b.classList.remove("activo"));
    [...document.querySelectorAll(".rubro-btn")].find(b=>b.innerText==r).classList.add("activo");

    let cont = document.getElementById("productos");
    cont.innerHTML = "";

    for (let p of productos.filter(x=>x.RUBRO==r)) {
        let img = await buscarImagen(p.CODIGO);
        cont.innerHTML += cardHTML(p,img);
    }
}

/* NOVEDADES */
async function mostrarNovedades() {
    document.querySelectorAll(".rubro-btn").forEach(b=>b.classList.remove("activo"));
    document.querySelector(".rubro-btn").classList.add("activo");

    let cont = document.getElementById("productos");
    cont.innerHTML = "";

    for (let p of productos.filter(x=>x.NEW=="SI")) {
        let img = await buscarImagen(p.CODIGO);
        cont.innerHTML += cardHTML(p,img);
    }
}

/* BUSCADOR AVANZADO */
document.getElementById("buscador").addEventListener("input", e=>{
    let t = e.target.value.toLowerCase().trim();
    let cont = document.getElementById("productos");
    cont.innerHTML = "";

    if (t=="") { mostrarNovedades(); return; }

    let palabras = t.split(/\s+/);

    productos.filter(p=>{
        let texto = Object.values(p).join(" ").toLowerCase();
        return palabras.every(w => texto.includes(w));
    }).forEach(async p=>{
        let img = await buscarImagen(p.CODIGO);
        cont.innerHTML += cardHTML(p,img);
    });
});
</script>

</body>
</html>
